unit udmPessoas;

interface

uses
  System.SysUtils, System.Classes, Data.FMTBcd, Datasnap.DBClient,
  Datasnap.Provider, Data.DB, Data.SqlExpr;

type
  TdmPessoas = class(TDataModule)
    sqlPqPessoas: TSQLDataSet;
    dspPqPessoas: TDataSetProvider;
    cdsPqPessoas: TClientDataSet;
    dspCadPessoa: TDataSetProvider;
    cdsCadPessoa: TClientDataSet;
    sqlCadPessoa: TSQLDataSet;
    cdsCadPessoaIDTITULAR: TIntegerField;
    cdsCadPessoaIDEMPRESA: TIntegerField;
    cdsCadPessoaNMTITULAR: TStringField;
    cdsCadPessoaNOCNPJCPF: TStringField;
    cdsCadPessoaNOINCRICAORG: TStringField;
    cdsCadPessoaDTNASCIMENTO: TDateField;
    cdsCadPessoaDTCADASTRO: TDateField;
    cdsCadPessoaTXEMAIL: TStringField;
    cdsCadPessoaTXOBS: TStringField;
    cdsCadPessoaTLRESIDENCIAL: TStringField;
    cdsCadPessoaTLCOMERCIAL: TStringField;
    cdsCadPessoaTLCELULAR: TStringField;
    cdsCadPessoaTLCONTATO: TStringField;
    cdsCadPessoaNMCONTATO: TStringField;
    cdsCadPessoaSTEXCLUIDO: TStringField;
    cdsCadPessoaDTEXCLUIDO: TDateField;
    cdsCadPessoaSTATIVO: TStringField;
    dspComboEmpresa: TDataSetProvider;
    cdsComboEmpresa: TClientDataSet;
    sqlComboEmpresa: TSQLDataSet;
    cdsComboEmpresaIDEMPRESA: TIntegerField;
    cdsComboEmpresaNMEMPRESA: TStringField;
    sqlCadPessoaIDTITULAR: TIntegerField;
    sqlCadPessoaIDEMPRESA: TIntegerField;
    sqlCadPessoaNMTITULAR: TStringField;
    sqlCadPessoaNOCNPJCPF: TStringField;
    sqlCadPessoaNOINCRICAORG: TStringField;
    sqlCadPessoaDTNASCIMENTO: TDateField;
    sqlCadPessoaDTCADASTRO: TDateField;
    sqlCadPessoaTXEMAIL: TStringField;
    sqlCadPessoaTXOBS: TStringField;
    sqlCadPessoaTLRESIDENCIAL: TStringField;
    sqlCadPessoaTLCOMERCIAL: TStringField;
    sqlCadPessoaTLCELULAR: TStringField;
    sqlCadPessoaTLCONTATO: TStringField;
    sqlCadPessoaNMCONTATO: TStringField;
    sqlCadPessoaSTEXCLUIDO: TStringField;
    sqlCadPessoaDTEXCLUIDO: TDateField;
    sqlCadPessoaSTATIVO: TStringField;
    procedure cdsPqPessoasAfterPost(DataSet: TDataSet);
    procedure cdsCadPessoaAfterOpen(DataSet: TDataSet);
    procedure cdsPqPessoasBeforePost(DataSet: TDataSet);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  dmPessoas: TdmPessoas;

implementation

uses
  udmPrincipal, uFuncoesDB;

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

procedure TdmPessoas.cdsCadPessoaAfterOpen(DataSet: TDataSet);
begin
  cdsComboEmpresa.Close;
  cdsComboEmpresa.Open;
end;

procedure TdmPessoas.cdsPqPessoasAfterPost(DataSet: TDataSet);
begin
  if cdsPqPessoas.FieldByName('').AsInteger = 0 then
  begin
    //PegarCodigoAutoIncrement
  end;
  
end;

procedure TdmPessoas.cdsPqPessoasBeforePost(DataSet: TDataSet);
begin
  if cdsPqPessoas.FieldByName('IDTITULAR').AsInteger = 0 then
  begin
    cdsPqPessoas.FieldByName('IDTITULAR').AsInteger := PegarCodigoAutoIncrement('CADTITULAR');
  end;
end;

end.
